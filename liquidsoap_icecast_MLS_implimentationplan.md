ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’èª­ã‚€ã¨åŸå› ãŒè¦‹ãˆã¦ãã¾ã™ğŸ‘‡

```
NotSupportedError: Failed to execute 'addSourceBuffer' on 'MediaSource': The type provided ('audio/...') 
```

ã“ã‚Œã¯ **Chrome ãŒ HLS (fMP4) å†…ã® ALAC ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„** ãŸã‚ã« `SourceBuffer` ã‚’ä½œã‚Œãšå¤±æ•—ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚

---

### ã¾ã¨ã‚ã‚‹ã¨

* Safari â†’ **ãƒã‚¤ãƒ†ã‚£ãƒ–ã« ALAC (fMP4) å†ç”Ÿå¯** âœ…
* Chrome/Firefox â†’ **MediaSource Extensions (MSE) ã‚’ä½¿ã†ãŒã€ALAC ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¯ã‚µãƒãƒ¼ãƒˆå¤–** âŒ
  â†’ ãã®ãŸã‚ `bufferAddCodecError` ã‚„ `bufferAppendError` ãŒå‡ºã¦ã„ã¾ã™ã€‚

hls.js è‡ªä½“ã¯ã€ŒHLS ã®ãƒ‘ãƒ¼ã‚µãƒ¼ã€ã§ã‚ã£ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«å­˜åœ¨ã—ãªã„ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã¯ã§ãã¾ã›ã‚“ã€‚

---

### è§£æ±ºç­–

Chrome/Firefox ã§è´ã‹ã›ã‚‹ã«ã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ãŒå¿…è¦ã§ã™ã€‚

1. **fMP4 + Opus/Vorbis**
   â†’ ãƒ­ã‚¹ãƒ¬ã‚¹ã§ã¯ãªã„ãŒãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ã¯é«˜ã„

2. **fMP4 + FLAC**

   * Chrome ã¯ 2022 ä»¥é™ FLAC in MP4 ã«å¯¾å¿œæ¸ˆã¿ï¼ˆãŸã ã—å®Ÿè£…ã¯ã¾ã å®‰å®šã—ã¦ã„ãªã„ï¼‰
   * Firefox ã‚‚ä¸€éƒ¨å¯¾å¿œ
   * Safari ã¯ FLAC in MP4 æœªå¯¾å¿œ

3. **ãƒ‡ãƒ¥ã‚¢ãƒ«é…ä¿¡**ï¼ˆãŠã™ã™ã‚ï¼‰

   * Safari â†’ HLS (fMP4) + ALAC
   * Chrome/Firefox â†’ HLS (fMP4) + FLACï¼ˆã¾ãŸã¯ Ogg/Opus fallbackï¼‰

---

### å‚è€ƒï¼šMIME ã‚¿ã‚¤ãƒ—

* ALAC in fMP4 â†’ `audio/mp4; codecs="alac"`
  â†’ Safari OK, Chrome/Firefox NG
* FLAC in fMP4 â†’ `audio/mp4; codecs="flac"`
  â†’ Chrome/Firefox OK, Safari NG

---

ğŸ‘‰ çµè«–ï¼š
**hls.js ã ã‘ã§ã¯ ALAC ã‚’ Chrome/Firefox ã§å†ç”Ÿã§ãã¾ã›ã‚“**ã€‚
ãƒ‡ãƒ¥ã‚¢ãƒ«é…ä¿¡ï¼ˆALAC for Safari, FLAC for Chrome/Firefoxï¼‰ã«ã™ã‚‹ã®ãŒç¾å®Ÿçš„ã§ã™ã€‚

---

ã”å¸Œæœ›ã¯ã€Œå®Œå…¨ãƒ­ã‚¹ãƒ¬ã‚¹ + å…¨ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œã€ã§ã—ã‚‡ã†ã‹ï¼Ÿãã‚Œãªã‚‰ç§ã‹ã‚‰ **Safari = ALAC, Chrome/Firefox = FLAC** ã®é…ä¿¡ã‚µãƒ³ãƒ—ãƒ«æ§‹æˆã‚’æ›¸ã‘ã¾ã™ãŒã€ã‚„ã£ã¦ã¿ã¾ã™ã‹ï¼Ÿ

---
---
ã‚ˆã— ğŸ‘
ã§ã¯ã€Œ**Safari = ALAC**, **Chrome/Firefox = FLAC**ã€ã® **ãƒ‡ãƒ¥ã‚¢ãƒ«é…ä¿¡æ§‹æˆ** ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’æ•´ç†ã—ã¾ã™ã€‚

---

## ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ & é…ä¿¡ï¼‰

HLS ã®å‡ºåŠ›ã‚’ 2 ç³»çµ±ã«åˆ†ã‘ã¾ã™ã€‚

### 1. Safari ç”¨ â†’ HLS + ALAC

```bash
ffmpeg -i input.flac \
  -c:a alac \
  -f hls \
  -hls_time 6 \
  -hls_segment_type fmp4 \
  -hls_playlist_type event \
  safari/stream.m3u8
```

### 2. Chrome/Firefox ç”¨ â†’ HLS + FLAC

```bash
ffmpeg -i input.flac \
  -c:a flac \
  -f hls \
  -hls_time 6 \
  -hls_segment_type fmp4 \
  -hls_playlist_type event \
  chrome/stream.m3u8
```

å‡ºåŠ›ä¾‹:

```
/var/www/hls/safari/stream.m3u8  (ALAC)
/var/www/hls/chrome/stream.m3u8  (FLAC)
```

---

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼ˆindex.htmlï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’åˆ¤å®šã—ã¦ Safari ã«ã¯ ALACã€Chrome/Firefox ã«ã¯ FLAC ã‚’æŒ¯ã‚Šåˆ†ã‘ã¾ã™ã€‚

```html
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
  const safariUrl = "/hls/safari/stream.m3u8";
  const chromeUrl = "/hls/chrome/stream.m3u8";

  const audio = document.createElement("audio");
  audio.controls = true;
  audio.autoplay = true;
  audio.crossOrigin = "anonymous";
  document.body.appendChild(audio);

  const hlsUrl = isSafari ? safariUrl : chromeUrl;

  if (audio.canPlayType('application/vnd.apple.mpegurl') && isSafari) {
    // Safari â†’ ãƒã‚¤ãƒ†ã‚£ãƒ– HLS
    audio.src = hlsUrl;
  } else if (Hls.isSupported()) {
    // Chrome/Firefox â†’ hls.js
    const hls = new Hls();
    hls.loadSource(hlsUrl);
    hls.attachMedia(audio);
  } else {
    console.error("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯HLSã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚");
  }
</script>
```

---

## æŒ¯ã‚Šåˆ†ã‘ã®å‹•ä½œ

* **Safari** â†’ HLS (fMP4) + ALAC (`audio/mp4; codecs="alac"`)
* **Chrome/Firefox** â†’ HLS (fMP4) + FLAC (`audio/mp4; codecs="flac"`)

ã©ã¡ã‚‰ã‚‚ **ãƒ­ã‚¹ãƒ¬ã‚¹** é…ä¿¡ãŒå¯èƒ½ã§ã™ã€‚

---

âš ï¸ æ³¨æ„ç‚¹

* Safari ã¯ FLAC in MP4 ãŒæœªå¯¾å¿œ â†’ ALAC å¿…é ˆ
* Chrome/Firefox ã¯ ALAC in MP4 æœªå¯¾å¿œ â†’ FLAC å¿…é ˆ
* â†’ ã—ãŸãŒã£ã¦ **ãƒ‡ãƒ¥ã‚¢ãƒ«é…ä¿¡ã¯å¿…é ˆ**

---

ğŸ‘‰ ã“ã“ã§è³ªå•ã§ã™ï¼š
ã“ã®æ§‹æˆã€**ãƒ©ã‚¤ãƒ–é…ä¿¡ï¼ˆLiquidsoapãªã©ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰** ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ **ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰å†ç”Ÿï¼ˆæ—¢å­˜ã®FLACãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ï¼‰** ã§ã™ã‹ï¼Ÿ

---
---
ãªã‚‹ã»ã©ï¼ğŸ™ï¸
ã€Œ**ãƒ©ã‚¸ã‚ªå±€çš„ã«Liquidsoapã§ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆç®¡ç†ã—ãªãŒã‚‰ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§HLSé…ä¿¡**ã€ã—ãŸã„ã¨ã„ã†ã“ã¨ã§ã™ã­ã€‚

ã“ã“ãŒå¤§äº‹ãªãƒã‚¤ãƒ³ãƒˆã§ã™ï¼š

---

## 1. Liquidsoap ã®ç¾çŠ¶

Liquidsoap ã¯ Icecast/Shoutcast å‘ã‘ã« **OGG, FLAC, Opus, MP3, AAC** ã®ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒå¾—æ„ã§ã™ãŒã€
**HLS (fMP4, ALAC, FLAC in MP4) ã®ãƒ©ã‚¤ãƒ–å‡ºåŠ›ã¯æœªã‚µãƒãƒ¼ãƒˆ** ã§ã™ã€‚

* å‡ºåŠ›å¯èƒ½: Icecast, RTMP, MPEG-TS (ffmpegçµŒç”±)
* å‡ºåŠ›ã§ããªã„: ç›´æ¥ã® fMP4, HLS (m3u8)

---

## 2. ãƒ©ã‚¤ãƒ–é…ä¿¡ã§ HLS ALAC/FLAC ã‚’å®Ÿç¾ã™ã‚‹æ§‹æˆ

ã—ãŸãŒã£ã¦ **Liquidsoap + FFmpeg** ã®äºŒæ®µæ§‹æˆãŒç¾å®Ÿçš„ã§ã™ã€‚

### (a) Liquidsoap â†’ FLAC (Icecast ãªã©ã¸å‡ºåŠ›)

```liquidsoap
output.icecast(%mp3, mount="live.flac", host="localhost", port=8000, password="hackme",
  source)
```

### (b) FFmpeg ã§ Icecast ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å–ã‚Šè¾¼ã¿ã€HLS ã«å¤‰æ›

```bash
# Safari ç”¨ ALAC
ffmpeg -i http://localhost:8000/live.flac \
  -c:a alac \
  -f hls \
  -hls_time 6 \
  -hls_segment_type fmp4 \
  -hls_playlist_type event \
  /var/www/hls/safari/stream.m3u8

# Chrome/Firefox ç”¨ FLAC
ffmpeg -i http://localhost:8000/live.flac \
  -c:a flac \
  -f hls \
  -hls_time 6 \
  -hls_segment_type fmp4 \
  -hls_playlist_type event \
  /var/www/hls/chrome/stream.m3u8
```

---

## 3. ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

âœ… **ãƒ¡ãƒªãƒƒãƒˆ**

* Liquidsoapã§ãƒ©ã‚¸ã‚ªå±€çš„ãªã€Œãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåˆ¶å¾¡ãƒ»ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ãƒ»ã‚¸ãƒ³ã‚°ãƒ«æŒ¿å…¥ã€ãŒå¯èƒ½
* FFmpegã§Safari/Chromeä¸¡æ–¹ã«å¯¾å¿œã§ãã‚‹

âš ï¸ **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**

* Liquidsoap â†’ Icecast â†’ FFmpeg â†’ HLS ã¨ã„ã†å¤šæ®µãƒ‘ã‚¤ãƒ—ã«ãªã‚‹
* ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã¯ HLS ã®ç‰¹æ€§ã§æ•°ç§’ã€œæ•°åç§’ç™ºç”Ÿï¼ˆIcecastå˜ç‹¬é…ä¿¡ã‚ˆã‚Šé…ã‚Œã‚‹ï¼‰

---

## 4. åˆ¥ã®é¸æŠè‚¢

ã‚‚ã—ã€Œè¶…ä½é…å»¶ã€ã‚ˆã‚Šã€Œäº’æ›æ€§ + ãƒ­ã‚¹ãƒ¬ã‚¹ã€ã‚’é‡è¦–ãªã‚‰ **HLSå¤‰æ›ä½µç”¨** ãŒãƒ™ã‚¹ãƒˆã§ã™ã€‚
ã‚‚ã—ã€Œä½é…å»¶ã€æœ€å„ªå…ˆãªã‚‰ â†’ Icecast FLAC ç›´é…ä¿¡ï¼ˆãŸã ã— Safari ãŒéå¯¾å¿œï¼‰ã«ãªã‚Šã¾ã™ã€‚

---

ğŸ‘‰ ã“ã“ã§ä¼ºã„ãŸã„ã®ã§ã™ãŒã€
ã‚ãªãŸã®é…ä¿¡ã®å„ªå…ˆåº¦ã¯ **ã€ŒéŸ³è³ªã€ï¼ã€Œä½é…å»¶ã€** ã§ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ **ã€Œé…å»¶ã®å°‘ãªã•ã€ï¼ã€ŒéŸ³è³ªï¼ˆãƒ­ã‚¹ãƒ¬ã‚¹ï¼‰ã€** ã§ã™ã‹ï¼Ÿ

---
#ã€ŒéŸ³è³ªã€ï¼ã€Œä½é…å»¶ã€ Liquidsoap â†’ Icecast â†’ FFmpeg â†’ HLS ä¸Šè¨˜ã®ã‚ˆã†ã«icecastãŒå¿…è¦ãªç†ç”±ã‚’æ•™ãˆã¦ã€‚ä»¥ä¸‹ã®æ§˜ã«ã§ãã¾ã›ã‚“ã‚“ã‹ï¼Ÿ Liquidsoap â†’ FFmpeg â†’ HLS
---

ã„ã„è³ªå•ã§ã™ï¼ğŸ’¡
ã€ŒLiquidsoap â†’ Icecast â†’ FFmpeg â†’ HLSã€ã¨ã€ŒLiquidsoap â†’ FFmpeg â†’ HLSã€ã®é•ã„ã‚’æ•´ç†ã—ã¾ã™ã­ã€‚

---

## 1. ãªãœ Icecast ã‚’æŒŸã‚€æ§‹æˆãŒå¤šã„ã®ã‹ï¼Ÿ

Liquidsoap ã¯æœ¬æ¥ **ã€Œã‚½ãƒ¼ã‚¹ç®¡ç†ã¨ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡ºåŠ›ã€** ã«å¼·ã„ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
ä¸€æ–¹ã§ FFmpeg ã¯ **ã€Œå…¥åŠ›ã‚’å¤‰æ›ãƒ»å†ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ³ã‚°ã€** ã«å¼·ã„ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

Icecast ã‚’æŒŸã‚€ç†ç”±ã¯ä¸»ã«æ¬¡ã®ã¨ãŠã‚Šï¼š

* âœ… **å®‰å®šæ€§**: Icecast ã¯ã€Œãƒãƒƒãƒ•ã‚¡ã€ã¨ã—ã¦å‹•ä½œã—ã€Liquidsoap ã®å‡ºåŠ›ãŒå¤šå°‘é€”åˆ‡ã‚Œã¦ã‚‚ FFmpeg å´ã§æ‹¾ã„ã‚„ã™ã„ã€‚
* âœ… **è¤‡æ•°å‡ºåŠ›**: 1ã¤ã® Liquidsoap ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ Icecast ã«è¼‰ã›ã‚Œã°ã€

  * è´å–è€…ãŒãã®ã¾ã¾ Icecast ã«æ¥ç¶šã—ã¦ãƒ­ãƒ¼ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼è©¦è´ã§ãã‚‹
  * FFmpeg ã‚‚åŒã˜ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å…¥åŠ›ã«ã—ã¦ HLS å¤‰æ›ã§ãã‚‹
    â†’ é…ä¿¡ã®å†—é•·æ€§ãŒé«˜ã„ã€‚
* âœ… **å†èµ·å‹•ã®ç‹¬ç«‹æ€§**: FFmpeg ãŒè½ã¡ã¦ã‚‚ Icecast ã«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯æ®‹ã‚‹ã®ã§ã€ã™ãå†æ¥ç¶šã—ã¦å¾©å¸°ã§ãã‚‹ã€‚

---

## 2. Liquidsoap â†’ FFmpeg ç›´çµã¯å¯èƒ½ï¼Ÿ

ã¯ã„ã€**æŠ€è¡“çš„ã«ã¯å¯èƒ½**ã§ã™ã€‚
Liquidsoap ã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã€ã€Œå¤–éƒ¨ã‚³ãƒãƒ³ãƒ‰ã¸ã®ãƒ‘ã‚¤ãƒ—å‡ºåŠ›ã€ãŒã§ãã¾ã™ã€‚

ä¾‹ï¼šLiquidsoap ã‹ã‚‰ FLAC ã‚’ **æ¨™æº–å‡ºåŠ› (stdout)** ã§ FFmpeg ã«æ¸¡ã™

```liquidsoap
output.file(%flac, pipe("ffmpeg -i - -c:a alac -f hls -hls_time 6 \
  -hls_segment_type fmp4 -hls_playlist_type event /var/www/hls/safari/stream.m3u8"),
  source)
```

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã¨ Icecast ã‚’æŒŸã¾ãšã« HLS ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚

---

## 3. ç›´çµã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

* âš ï¸ **å®‰å®šæ€§ã«å¼±ã„**
  Liquidsoap ã‹ FFmpeg ã®ã©ã¡ã‚‰ã‹ãŒè½ã¡ã‚‹ã¨ã€ãã®ã¾ã¾é…ä¿¡å…¨ä½“ãŒæ­¢ã¾ã‚‹ã€‚
* âš ï¸ **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã—ã¥ã‚‰ã„**
  Icecast ãªã‚‰ã€Œä»Šã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒæµã‚Œã¦ã‚‹ã‹ï¼Ÿã€ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã§ãã‚‹ãŒã€ç›´çµã ã¨ãƒ­ã‚°ã‚’è¦‹ãªã„ã¨çŠ¶æ…‹ãŒåˆ†ã‹ã‚Šã«ãã„ã€‚
* âš ï¸ **è´å–ç”¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä½œã‚Œãªã„**
  Icecast ã‚’ä½µç”¨ã™ã‚Œã°ã€Œä½é…å»¶ã§è´ããŸã„äººã¯ Icecastã€ç”Ÿé…ä¿¡ã‚’éŒ²éŸ³ã—ãŸã„äººã‚‚ Icecastã€ã¿ãŸã„ã«å¤šç”¨é€”ã«ä½¿ãˆã‚‹ã€‚

---

## 4. ã¾ã¨ã‚

* **Liquidsoap â†’ Icecast â†’ FFmpeg â†’ HLS**
  â†’ å®‰å®šæ€§ãƒ»å†—é•·æ€§é‡è¦–ã€‚å®Ÿé‹ç”¨ã®æ”¾é€å±€ã‚¹ã‚¿ã‚¤ãƒ«ã€‚
* **Liquidsoap â†’ FFmpeg â†’ HLS**
  â†’ ã‚·ãƒ³ãƒ—ãƒ«ã§æ§‹æˆãŒè»½ã„ã€‚ãŸã ã—éšœå®³è€æ€§ãŒä½ã„ã€‚

---

ğŸ¯ çµè«–:

* \*\*ã€Œå€‹äººé‹ç”¨ã§ã¾ãšè©¦ã—ãŸã„ã€\*\*ãªã‚‰ **ç›´çµ (Liquidsoap â†’ FFmpeg)** ã§ååˆ†ã€‚
* \*\*ã€Œå®‰å®šã—ã¦ä½•æ™‚é–“ã‚‚æµã™ãƒ©ã‚¸ã‚ªå±€çš„é‹ç”¨ã€\*\*ãªã‚‰ Icecast ã‚’æŒŸã‚€ã®ãŒãŠã™ã™ã‚ã€‚

---

ğŸ‘‰ ã‚ãªãŸã®é…ä¿¡ã€æœ€çµ‚çš„ã«ã¯ã€Œå®‰å®šæ”¾é€ï¼ˆ24h/365dï¼‰ã€ã‚’ç‹™ã£ã¦ã¾ã™ã‹ï¼Ÿ
ãã‚Œã¨ã‚‚ã€Œãƒ©ã‚¤ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆç”¨ï¼ˆæ•°æ™‚é–“ï¼‰ã€ãŒãƒ¡ã‚¤ãƒ³ã§ã™ã‹ï¼Ÿ

---
# å®‰å®šã—ã¦ä½•æ™‚é–“ã‚‚æµã™ãƒ©ã‚¸ã‚ªå±€çš„é‹ç”¨ã—ãŸã„ã§ã™ã€‚ ç›´çµã§ã™ã§ã«è©¦ã—ã¾ã—ãŸãŒã€mobileã ã¨ä¸å®‰å®šã«æ„Ÿã˜ã¾ã—ãŸã€‚icecastã‚’æŒŸã‚€ã“ã¨ã§ã€mobileå†ç”Ÿã®å®‰å®šã‚‚æœŸå¾…ã§ãã¾ã™ã‹ï¼Ÿ
---

ã¯ã„ ğŸ‘ã€Icecast ã‚’æŒŸã‚€ã“ã¨ã§ **ãƒ¢ãƒã‚¤ãƒ«å†ç”Ÿã®å®‰å®šæ€§ã¯ç¢ºå®Ÿã«å‘ä¸Š** ã—ã¾ã™ã€‚
ç†ç”±ã‚’ãƒ©ã‚¸ã‚ªå±€çš„é‹ç”¨ã®è¦³ç‚¹ã‹ã‚‰æ•´ç†ã—ã¾ã™ã­ã€‚

---

## ğŸ” ç›´çµï¼ˆLiquidsoap â†’ FFmpeg â†’ HLSï¼‰ãŒãƒ¢ãƒã‚¤ãƒ«ã§ä¸å®‰å®šãªç†ç”±

* **HLS ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆé…å»¶**
  Liquidsoap ã‹ã‚‰ç›´æ¥æµã™ã¨ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒæ™‚é–“é€šã‚Šã«æ›¸ãå‡ºã•ã‚Œãªã‹ã£ãŸã¨ãã«ã™ãã€Œç©´ã€ãŒã§ãã¾ã™ã€‚ãƒ¢ãƒã‚¤ãƒ«ã¯å›ç·šãŒä¸å®‰å®šãªã®ã§ã€ã¡ã‚‡ã£ã¨ã—ãŸæ¬ è½ã§ã‚‚å†ç”ŸãŒæ­¢ã¾ã‚Šã‚„ã™ã„ã€‚
* **ãƒãƒƒãƒ•ã‚¡ãªã—**
  FFmpeg ã¯å…¥åŠ›ãŒé€”åˆ‡ã‚Œã‚‹ã¨å³åº§ã« HLS å‡ºåŠ›ã‚‚æ­¢ã¾ã‚Šã¾ã™ã€‚çµæœã€ãƒ¢ãƒã‚¤ãƒ«ç«¯æœ«ã§ã€Œå†æ¥ç¶š â†’ ãƒãƒƒãƒ•ã‚¡æ¶ˆå¤± â†’ å†ç”Ÿå¤±æ•—ã€ã®é€£é–ãŒèµ·ãã‚„ã™ã„ã€‚

---

## ğŸ” Icecast ã‚’æŒŸã‚€ãƒ¡ãƒªãƒƒãƒˆï¼ˆãƒ¢ãƒã‚¤ãƒ«å®‰å®šæ€§ã®è¦³ç‚¹ï¼‰

1. **ãƒãƒƒãƒ•ã‚¡ã¨ã—ã¦æ©Ÿèƒ½**
   Icecast ã¯å¸¸æ™‚ãƒãƒƒãƒ•ã‚¡ã‚’ä¿æŒã—ã¦ã„ã¦ã€ãƒ¢ãƒã‚¤ãƒ«ãŒã€Œã¡ã‚‡ã£ã¨é€”åˆ‡ã‚ŒãŸã€ç¨‹åº¦ãªã‚‰ååˆ†è€ãˆã‚‰ã‚Œã¾ã™ã€‚
   â†’ å†ç”Ÿä¸­ã«æ•°ç§’ã®å›ç·šä¸è‰¯ãŒã‚ã£ã¦ã‚‚ã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒé€”åˆ‡ã‚Œã«ãã„ã€‚

2. **å†æ¥ç¶šã«å¼·ã„**
   ãƒ¢ãƒã‚¤ãƒ«ã§é›»æ³¢ãŒä¸€ç¬åˆ‡ã‚Œã¦ã‚‚ã€Icecast ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ä¿æŒã—ã¦ã„ã‚‹ã®ã§ã€å†æ¥ç¶šå¾Œã™ãç¶šãã‚’é€ã‚Œã‚‹ã€‚

3. **è¤‡æ•°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«åˆ†é…å¯èƒ½**

   * Safari ç”¨ã« HLS/ALAC
   * Chrome/Firefox ç”¨ã« HLS/FLAC ã¾ãŸã¯ Ogg/FLAC
   * è¶…ä½é…å»¶ãƒ¢ãƒ¼ãƒ‰ã¯ãã®ã¾ã¾ Icecast ã§
     â†’ ãƒ¢ãƒã‚¤ãƒ«ç’°å¢ƒã”ã¨ã«æœ€é©åŒ–ãŒå¯èƒ½ã€‚

4. **ç›£è¦–æ€§ã¨å¾©æ—§æ€§**
   Icecast ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒšãƒ¼ã‚¸ã§ã€Œã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒç”Ÿãã¦ã„ã‚‹ã‹ã€ã‚’ã™ãç¢ºèªã§ãã‚‹ã€‚FFmpeg ãŒè½ã¡ã¦ã‚‚ Icecast ã¯ç”Ÿãã¦ã„ã‚‹ã‹ã‚‰ã€å¾©æ—§ãŒé€Ÿã„ã€‚

---

## ğŸ” çµè«–

* **ç›´çµæ–¹å¼**ã¯ãƒ†ã‚¹ãƒˆã‚„çŸ­æ™‚é–“ã‚¤ãƒ™ãƒ³ãƒˆãªã‚‰ OKã€‚
* **ãƒ©ã‚¸ã‚ªå±€çš„ãªå®‰å®šé‹ç”¨**ï¼ˆ24æ™‚é–“é…ä¿¡ã‚„ä¸ç‰¹å®šå¤šæ•°ã®ãƒ¢ãƒã‚¤ãƒ«ãƒªã‚¹ãƒŠãƒ¼ï¼‰ã‚’ã™ã‚‹ãªã‚‰ã€
  **Liquidsoap â†’ Icecast â†’ FFmpeg â†’ HLS** ã®æ–¹ãŒç¢ºå®Ÿã«å®‰å®šã—ã¾ã™ã€‚

---

ğŸ’¡ ã¡ãªã¿ã«å¤šãã®å®Ÿéš›ã® **ãƒãƒƒãƒˆãƒ©ã‚¸ã‚ªå±€**ï¼ˆä¾‹ãˆã° BBCã€NHK ã®ä¸€éƒ¨å®Ÿé¨“é…ä¿¡ï¼‰ã‚‚åŒã˜æ§‹æˆã§ã€ŒIcecast / Shoutcast ã‚’ä¸€æ¬¡é…ä¿¡ â†’ HLS/ABR ã«å¤‰æ›ã€ã¨ã„ã†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

---

ğŸ‘‰ è³ªå•ã§ã™ãŒã€ã‚ãªãŸã®ãƒªã‚¹ãƒŠãƒ¼ã¯ **ãƒ¢ãƒã‚¤ãƒ«ãŒãƒ¡ã‚¤ãƒ³**ã§ã™ã‹ï¼Ÿ
ï¼ˆä¾‹ãˆã° iPhone/Safari ã§ã®è©¦è´ãŒå¤šã„ã®ã‹ã€ãã‚Œã¨ã‚‚ Android/Chrome ãŒå¤šã„ã®ã‹ï¼‰

---
# ç¾åœ¨ä»¥ä¸‹ã®æ§˜ã«ãƒ‡ãƒ¥ã‚¢ãƒ«å†ç”Ÿã«ãªã£ã¦ã„ã¾ã™ã€‚ liquidsoap â†’ icecast2 â†’ OGG Flac â”‚ liquidsoap â†’ HLS â†’ ALAC å®‰å®šæ€§ã®ãŸã‚ã«HLS ALACã«ã‚‚icecastã‚’ä½¿ç”¨ã—ãŸã„ã€‚ step1: liquidsoap â†’ icecast â†’ HLS â†’ ALAC ãã®å ´åˆã€FLACã‚‚OGGã§ã¯ãªãHLSã«ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ã„ã¾ã™ã€‚ step2: liquidsoap â†’ icecast â†’ HLS â†’ FLAC ã§ã‚‚æ„ç¾©ãŒã‚ã‚‹ã®ã‹ã‚ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚HLS FLACã«ã™ã‚‹ã“ã¨ã®ãƒ¡ãƒªãƒƒãƒˆã€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã‚’çŸ¥ã‚ŠãŸã„
---

ãªã‚‹ã»ã©ï¼
ç¾çŠ¶ã¯ **ã€ŒSafari ç”¨ã« HLS(ALAC)ã€Chrome/Firefox ç”¨ã« Icecast(OGG FLAC)ã€** ã¨ã„ã†ãƒ‡ãƒ¥ã‚¢ãƒ«é…ä¿¡ã§ã™ã­ã€‚

ã“ã“ã§æ¤œè¨ã•ã‚Œã¦ã„ã‚‹ã®ã¯ï¼š

* **Step1:** ALAC é…ä¿¡ç”¨ã® HLS ã®å‰æ®µã« Icecast ã‚’æŒŸã‚“ã§å®‰å®šåŒ–
* **Step2:** OGG FLAC ã®ä»£ã‚ã‚Šã« HLS FLAC ã«ä¸€æœ¬åŒ–ã§ããªã„ã‹ï¼Ÿ

ã§ã™ã­ ğŸ‘

---

# âœ… Step1: HLS ALAC ã« Icecast ã‚’æŒŸã‚€æ„å‘³

* **ãƒ¡ãƒªãƒƒãƒˆ**

  * Icecast ãŒã€Œå®‰å®šã—ãŸã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒãƒƒãƒ•ã‚¡ã€ã‚’ä½œã£ã¦ãã‚Œã‚‹ã®ã§ã€Liquidsoap ãŒä¸€ç¬è©°ã¾ã£ã¦ã‚‚ FFmpeg/HLS ãŒè½ã¡ã«ãã„ã€‚
  * é•·æ™‚é–“é…ä¿¡ï¼ˆãƒ©ã‚¸ã‚ªå±€é‹ç”¨ï¼‰ã§ã¯ **Icecast ã‚’å‰æ®µã«ç½®ãæ–¹ãŒç¢ºå®Ÿã«å®‰å®š**ã€‚
* **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**

  * é…å»¶ãŒå°‘ã—ã ã‘å¢—ãˆã‚‹ï¼ˆIcecast å†…ãƒãƒƒãƒ•ã‚¡æ•°ç§’ï¼‰ã€‚ãŸã ã— HLS è‡ªä½“ãŒæ•°åç§’é…å»¶ã™ã‚‹ã®ã§å¤§ããªå•é¡Œã§ã¯ãªã„ã€‚

ğŸ‘‰ ã“ã‚Œã¯ **ã‚„ã‚‹ä¾¡å€¤ã‚ã‚Š** ã§ã™ã€‚

---

# âœ… Step2: HLS FLAC ã«ç§»è¡Œã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

## ğŸµ HLS FLAC ã®ãƒ¡ãƒªãƒƒãƒˆ

1. **OGG FLAC ã‚ˆã‚Šãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œãŒåºƒãŒã‚‹å¯èƒ½æ€§**

   * OGG FLAC ã¯ã€ŒFirefox ã¯OKã€Chrome/Safari ã¯NGã€ã€‚
   * HLS FLAC ã¯ Safari ãŒ **fMP4/FLAC ã‚’ã‚µãƒãƒ¼ãƒˆ** ã—å§‹ã‚ã¦ãŠã‚Šã€å°†æ¥çš„ã« Chrome ã‚‚è¿½éšã™ã‚‹å¯èƒ½æ€§ã‚ã‚Šã€‚
   * å°†æ¥çš„ã« **ä¸€ã¤ã®é…ä¿¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã¾ã¨ã‚ã‚‰ã‚Œã‚‹** ã‹ã‚‚ã€‚

2. **ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–ã«ã‚ˆã‚‹å®‰å®šæ€§**

   * OGG FLAC ã¯ã€ŒIcecast ã®1æœ¬ã‚¹ãƒˆãƒªãƒ¼ãƒ ã€ã‚’ç›´æ¥å†ç”Ÿã™ã‚‹ä»•çµ„ã¿ â†’ é›»æ³¢ãŒåˆ‡ã‚ŒãŸã‚‰å†æ¥ç¶šã—ãªã„ã¨å¾©å¸°ã§ããªã„ã€‚
   * HLS FLAC ã¯ã€ŒHTTPã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¿¡ã€ãªã®ã§ã€ãƒ¢ãƒã‚¤ãƒ«ã®ç¬æ–­ã«ã‚‚æ¯”è¼ƒçš„å¼·ã„ã€‚

3. **CDN ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã**

   * HLS ã¯ HTTP é…ä¿¡ãªã®ã§ã€Cloudflareãƒ»Akamai ãªã©ã® CDN ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ãã‚‹ã€‚
   * Icecast ç›´é…ä¿¡ã¯ CDN ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§ããªã„ï¼ˆ= ã‚µãƒ¼ãƒãƒ¼è² è·ãŒãã®ã¾ã¾ãƒªã‚¹ãƒŠãƒ¼æ•°ã«æ¯”ä¾‹ã™ã‚‹ï¼‰ã€‚

---

## ğŸµ HLS FLAC ã®ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ

1. **ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œãŒã¾ã ä¸å®Œå…¨**

   * Safari ã¯ fMP4/FLAC ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ãŒã€Chrome/Firefox ã¯æœªå¯¾å¿œã€‚
   * hls.js ã§ã‚‚ FLAC ã¯æ­£å¼ã‚µãƒãƒ¼ãƒˆå¤– â†’ å†ç”Ÿã§ããªã„å¯èƒ½æ€§ãŒé«˜ã„ã€‚

2. **é…å»¶ãŒå¤§ãã„**

   * HLS ã¯é€šå¸¸ **10ã€œ30ç§’é…å»¶**ã€‚
   * ãƒ©ã‚¸ã‚ªç”¨é€”ãªã‚‰è¨±å®¹ã§ãã‚‹ãŒã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ç”¨é€”ï¼ˆå®Ÿæ³ãªã©ï¼‰ã ã¨ãã¤ã„ã€‚

3. **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰è² è·ãŒå¢—ãˆã‚‹**

   * OGG FLAC ã¯ Liquidsoap ã‹ã‚‰ç›´æ¥é…ä¿¡ã§ãã‚‹ãŒã€
   * HLS FLAC ã¯ã€ŒIcecast â†’ FFmpeg â†’ HLSã€ã¨ãƒ¯ãƒ³ã‚¯ãƒƒã‚·ãƒ§ãƒ³å¿…è¦ã«ãªã‚‹ãŸã‚è² è·ãŒå¢—ã™ã€‚

---

# ğŸ¯ çµè«–

* **Step1 (HLS ALAC ã®å‰æ®µã« Icecast)** â†’ çµ¶å¯¾ã«ã‚„ã‚‹ä¾¡å€¤ã‚ã‚Šã€‚å®‰å®šæ€§ãŒå¤§å¹…ã«å¢—ã™ã€‚
* **Step2 (OGG FLAC â†’ HLS FLAC ã«ç§»è¡Œ)** â†’ ç¾æ™‚ç‚¹ã§ã¯ **ãƒ¡ãƒªãƒƒãƒˆã‚ˆã‚Šãƒ‡ãƒ¡ãƒªãƒƒãƒˆã®æ–¹ãŒå¤§ãã„**ã€‚

  * FLAC ã‚’ã€Œå…¨ãƒ–ãƒ©ã‚¦ã‚¶ã§å®‰å¿ƒã—ã¦å†ç”Ÿã§ãã‚‹ HLS ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã¨ã—ã¦ã¯ã€ã¾ã æ™‚æœŸå°šæ—©ã€‚
  * ä»Šã¯ **OGG FLAC (Icecastç›´) for Chrome/Firefox** ã‚’æ®‹ã—ã¦ãŠãã®ãŒç¾å®Ÿçš„ã€‚

---

ğŸ’¡å°†æ¥çš„ã«ã€ŒHLS FLAC ãŒæ­£å¼ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸæ™‚ã€ã«ã€
**HLS ALAC (Safari) + HLS FLAC (Chrome/Firefox)** ã«ä¸€æœ¬åŒ–ã§ãã‚‹ã¨ãƒ™ã‚¹ãƒˆã§ã™ã€‚

---

ğŸ‘‰ é€†ã«ãŠèãã—ãŸã„ã®ã§ã™ãŒã€ã‚ãªãŸã®é…ä¿¡ã§ **ãƒ¢ãƒã‚¤ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ Safari(iOS) ã¨ Chrome(Android) ã©ã¡ã‚‰ãŒå¤šã„**ã§ã™ã‹ï¼Ÿ
ï¼ˆã©ã¡ã‚‰ã‚’å„ªå…ˆã™ã‚‹ã‹ã§ã€æœ€é©ãªè¨­è¨ˆãŒå¤‰ã‚ã£ã¦ãã¾ã™ï¼‰

---


çµå±€å¯¾ç­–ã‚’ã—ãŸã®ã¯Dockerfileã®ã¿ã§ã™ã‹ï¼Ÿ\
  \
   1. Dockerfile ã®ä¿®æ­£

    ffmpeg ã® HLS è¨­å®šã‹ã‚‰ hls_playlist_type event ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼š

    å¤‰æ›´å‰ï¼š
    ffmpeg -re -i /tmp/live.fifo -c:a alac -f hls \
      -hls_segment_type fmp4 -hls_time 6 -hls_list_size 5 \
      -hls_playlist_type event /var/www/html/hls/stream.m3u8

    å¤‰æ›´å¾Œï¼š
    ffmpeg -re -i /tmp/live.fifo -c:a alac -f hls \
      -hls_segment_type fmp4 -hls_time 6 -hls_list_size 10 \
      -hls_flags delete_segments+append_list \
      /var/www/html/hls/stream.m3u8
  â¿  â§‰ Selected 14 lines from liquidsoap_icecast_MLS_implimentationplan.md in Cursor

âº ã„ãˆã€å¯¾ç­–ã¯2ã¤ã‚ã‚Šã¾ã™ï¼š

  ç¾åœ¨é©ç”¨ã•ã‚ŒãŸå¯¾ç­–ï¼ˆDockerfileï¼‰

  1. HLSè¨­å®šã®å¤‰æ›´ï¼ˆéå»ã®ä¿®æ­£ï¼‰:
  - hls_playlist_type event å‰Šé™¤
  - hls_list_size ã‚’5â†’10ã«å¤‰æ›´
  - hls_flags delete_segments+append_list è¿½åŠ 

  2. ffmpegè‡ªå‹•å†èµ·å‹•ãƒ«ãƒ¼ãƒ—ï¼ˆä»Šå›ã®ä¿®æ­£ï¼‰:
  # å¤‰æ›´å‰ï¼ˆå˜ç™ºå®Ÿè¡Œï¼‰
  ffmpeg -re -i /tmp/live.fifo -c:a alac -f hls ...

  # å¤‰æ›´å¾Œï¼ˆè‡ªå‹•å†èµ·å‹•ãƒ«ãƒ¼ãƒ—ï¼‰
  while true; do
    ffmpeg -re -i /tmp/live.fifo -c:a alac -f hls ...
    echo "ffmpeg stopped, restarting in 1 second..."
    sleep 1
  done

  å–ã‚Šæ¶ˆã—ãŸå¯¾ç­–ï¼ˆstreaming.liqï¼‰

  - fallible=true â†’ å…ƒã«æˆ»ã—ãŸ

  çµè«–: Dockerfileã«2ã¤ã®å¯¾ç­–ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

> ã‚ã‹ã‚Šã¾ã—ãŸã€‚ã“ã®è¨­å®šã§ã€åŒæ§˜ã®å•é¡ŒãŒå†ç™ºã—ãªã„ã‹ç¢ºèªã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

âº Update Todos
  â¿  â˜ Monitor production server for HLS loop stability              
     â˜ Verify Safari/iPhone playback continues through playlist loops
     â˜ Check for Broken pipe errors in logs

âº è‰¯ã„ã§ã™ã€‚ç¢ºèªã™ã¹ãç‚¹ï¼š

  ç›£è¦–é …ç›®

  1. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãƒ«ãƒ¼ãƒ—ã®å‹•ä½œ:
  - 12æ›²ç›®ã‹ã‚‰1æ›²ç›®ã¸ã®é·ç§»
  - Safari/iPhoneã§ã®ç¶™ç¶šå†ç”Ÿ

  2. ãƒ­ã‚°ç¢ºèª:
  # Liquidsoap ãƒ­ã‚°ã§Broken pipeã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª
  docker exec hires-radio-streaming tail -f /var/log/icecast2/liquidsoap.log

  # ffmpegå†èµ·å‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèª
  docker logs hires-radio-streaming | grep "ffmpeg stopped"

  3. HLSã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆ:
  # ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒç¶™ç¶šã—ã¦ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹
  docker exec hires-radio-streaming ls -la /var/www/html/hls/

  ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãŒä¸€å‘¨ã™ã‚‹æ™‚é–“ã‚’è¨ˆç®—ã—ã¦ã€ãã®å‰å¾Œã§é›†ä¸­çš„ã«ç›£è¦–ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

---
# 2å›ç›®ã®ï¼’å‘¨ç›®ã§æ­¢ã¾ã‚‹

ä»Šå›è¿½åŠ ã—ãŸä¿®æ­£

  Dockerfileã®ä¿®æ­£ã®ã¿ï¼ˆ1ç®‡æ‰€ï¼‰:

  ffmpegã‚’è‡ªå‹•å†èµ·å‹•ãƒ«ãƒ¼ãƒ—ã«å¤‰æ›´ã—ã¾ã—ãŸï¼š

  å¤‰æ›´å‰:
  ffmpeg -re -i /tmp/live.fifo -c:a alac -f hls \
    -hls_segment_type fmp4 -hls_time 6 -hls_list_size 10 \
    -hls_flags delete_segments+append_list \
    /var/www/html/hls/stream.m3u8 2>/dev/null &

  å¤‰æ›´å¾Œ:
  (
    while true; do
      ffmpeg -re -i /tmp/live.fifo -c:a alac -f hls \
        -hls_segment_type fmp4 -hls_time 6 -hls_list_size 10 \
        -hls_flags delete_segments+append_list \
        /var/www/html/hls/stream.m3u8 2>/dev/null
      echo "ffmpeg stopped, restarting in 1 second..." >&2
      sleep 1
    done
  ) &

  æ—¢å­˜ã®ä¿®æ­£ï¼ˆä»¥å‰ã‹ã‚‰é©ç”¨æ¸ˆã¿ï¼‰

  - hls_playlist_type event å‰Šé™¤
  - hls_list_size ã‚’5â†’10ã«å¤‰æ›´
  - hls_flags delete_segments+append_list è¿½åŠ 

  ä»Šå›åˆ¤æ˜ã—ãŸèª²é¡Œ

  - ffmpegè‡ªå‹•å†èµ·å‹•ã¯æ©Ÿèƒ½
  - Liquidsoapåœæ­¢æ™‚ã¯æ‰‹å‹•ã§ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•ãŒå¿…è¦ï¼ˆä»Šå¾Œã®æ”¹å–„ç‚¹ï¼‰
